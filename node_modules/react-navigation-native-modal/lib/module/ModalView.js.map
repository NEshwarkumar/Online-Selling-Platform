{"version":3,"sources":["ModalView.tsx"],"names":["React","View","Modal","StyleSheet","NavigationHelpersContext","StackActions","CommonActions","ModalView","state","navigation","descriptors","styles","container","routes","reduceRight","acc","route","index","focused","descriptor","key","animationType","options","element","absoluteFill","render","onOrientationChange","e","emit","type","target","data","nativeEvent","onOpen","dispatch","s","routeNames","includes","name","some","r","navigate","reset","onClose","pop","source","create","flex"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { View, Modal, StyleSheet, NativeSyntheticEvent } from 'react-native';\nimport {\n  NavigationHelpersContext,\n  StackNavigationState,\n  ParamListBase,\n  StackActions,\n  CommonActions,\n} from '@react-navigation/native';\nimport type {\n  ModalDescriptorMap,\n  ModalNavigationConfig,\n  ModalNavigationHelpers,\n} from './types';\n\ntype Props = ModalNavigationConfig & {\n  state: StackNavigationState<ParamListBase>;\n  navigation: ModalNavigationHelpers;\n  descriptors: ModalDescriptorMap;\n};\n\nexport default function ModalView({ state, navigation, descriptors }: Props) {\n  return (\n    <NavigationHelpersContext.Provider value={navigation}>\n      <View style={styles.container}>\n        {state.routes.reduceRight<JSX.Element>((acc, route, index) => {\n          const focused = index === state.index;\n          const descriptor = descriptors[route.key];\n          const { animationType = 'slide', ...options } = descriptor.options;\n\n          const element = (\n            <>\n              <View\n                style={StyleSheet.absoluteFill}\n                accessibilityElementsHidden={!focused}\n                importantForAccessibility={\n                  focused ? 'auto' : 'no-hide-descendants'\n                }\n              >\n                {descriptor.render()}\n              </View>\n              {acc}\n            </>\n          );\n\n          if (index === 0) {\n            return element;\n          }\n\n          const onOrientationChange = (e: NativeSyntheticEvent<any>) =>\n            navigation.emit({\n              type: 'orientationChange',\n              target: route.key,\n              data: e.nativeEvent,\n            });\n\n          const onOpen = () => {\n            navigation.dispatch((s) => {\n              if (\n                s.routeNames.includes(route.name) &&\n                !s.routes.some((r) => r.key === route.key)\n              ) {\n                // If route isn't present in current state, but was closing, assume that a close animation was cancelled\n                // So we need to add this route back to the state\n                return CommonActions.navigate(route);\n              } else {\n                return CommonActions.reset(s);\n              }\n            });\n          };\n\n          const onClose = () =>\n            navigation.dispatch((s) => {\n              // If a route exists in state, trigger a pop\n              // This will happen in when the route was closed from native side\n              // e.g. When the close animation triggered from a gesture ends\n              if (s.routes.some((r) => r.key === route.key)) {\n                return {\n                  ...StackActions.pop(),\n                  source: route.key,\n                  target: s.key,\n                };\n              } else {\n                return CommonActions.reset(s);\n              }\n            });\n\n          return (\n            <Modal\n              {...options}\n              animationType={animationType}\n              onOrientationChange={onOrientationChange}\n              onShow={onOpen}\n              onDismiss={onClose}\n              onRequestClose={onClose}\n              visible\n            >\n              {element}\n            </Modal>\n          );\n        }, <></>)}\n      </View>\n    </NavigationHelpersContext.Provider>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n});\n"]}